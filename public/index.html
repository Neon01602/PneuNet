<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pneumonia Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
  <h1 class="text-3xl font-bold mb-6 text-blue-800">Pneumonia Detection</h1>

  <input id="imageInput" type="file" class="mb-4" accept="image/*" />
  <button id="predictBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Predict</button>

  <div id="previewContainer" class="hidden mt-4">
    <img id="previewImage" class="max-w-xs rounded shadow" />
  </div>

  <div id="result" class="hidden mt-4 p-4 bg-white rounded shadow">
    <p id="predictionText" class="text-lg font-semibold"></p>
    <p id="probabilityText" class="text-sm text-gray-600"></p>
  </div>

  <script>
    const predictBtn = document.getElementById("predictBtn");
    const imageInput = document.getElementById("imageInput");
    const resultDiv = document.getElementById("result");
    const predictionText = document.getElementById("predictionText");
    const probabilityText = document.getElementById("probabilityText");
    const previewContainer = document.getElementById("previewContainer");
    const previewImage = document.getElementById("previewImage");

    let selectedFile;

    imageInput.addEventListener("change", (e) => {
      if (e.target.files.length > 0) {
        selectedFile = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          previewImage.src = reader.result;
          previewContainer.classList.remove("hidden");
        };
        reader.readAsDataURL(selectedFile);
      }
    });

    predictBtn.addEventListener("click", async () => {
      if (!selectedFile) {
        alert("Please upload an image first!");
        return;
      }

      predictionText.textContent = "Processing...";
      probabilityText.textContent = "";
      resultDiv.classList.remove("hidden");

      const formData = new FormData();
      formData.append("image", selectedFile);

      try {
        const response = await fetch("/api/predict", {
          method: "POST",
          body: formData,
        });
        const data = await response.json();

        if (data.error) {
          predictionText.textContent = "Error during prediction!";
          probabilityText.textContent = "";
        } else {
          const prediction = data.result[0]; // Label
          const probability = (parseFloat(data.result[1]) * 100).toFixed(2);
          predictionText.textContent = `Result: ${prediction}`;
          probabilityText.textContent = `Confidence: ${probability}%`;
        }
      } catch (err) {
        predictionText.textContent = "Error during prediction!";
        probabilityText.textContent = "";
        console.error(err);
      }
    });
  </script>
</body>
</html>